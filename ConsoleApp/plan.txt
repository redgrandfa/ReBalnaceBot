資產比例計劃書

class 資產比例計劃書{

	Dictionary< string , decimal或int >  Body 
		symbol 	percent
	

	建構式
		1. 寫死
		2. 從DB抓取，開API可更新。
}


邏輯
	排程  設定頻率 與開關時間 (一般開盤時間   但如果混部位就沒意義  貨幣是24小時)
	API 檢查市場狀態 開市 
		=> 可否開市時 才 臨時啟用每輪執行
	

	頻率每輪執行每五分鐘執行:
		(檢查是否每一項標的都可交易??) (不可交易的還會變動市值??)  
		還是就針對可交易的先交易? => 至少可交易的會滿足比例
		
		若可
			刪所有訂單
			檢查部位
				每項市值
				(現金市值 由DB紀錄值 抓取  快取在變數...?)

				市值 計算總淨值
				市值 計算各項比例

				( 交易稅...? 手續費...?  可定義出 [最優單筆加減碼數值] )


			再平衡
				每項的 計畫比例 => (若查不到key則為0)
					計算[理論加減碼]

					簡單：市值計算+買賣?? 滑價風險?
						以方才的市值數字 做限價買賣 => 延遲風險 => 既然都有風險就 市價?

					// 最高買價
					// 最低賣價

				( 計算 拆單筆數 = 理應加減碼/最優單筆加減碼數值  )

				計算[理應加減量]
					
					[理應加減量] = 理應加減碼 / [價]  再[取整] (預計 向上取整  賣(負的)量變小 買量變大)

					最優 加減碼數值 如何 優化摩擦費用?
					(碎片化交易 https://alpaca.markets/docs/trading/fractional-trading/)
					
				下訂單
					檢查是否標的可交易??
					symbol , qty (負代表賣 合併邏輯... 賣量事前檢查)
				( 檢查部位回報 或無所謂)
	

==========
	RestClientErrorException: notional amount must be >= 1.
	trade denied due to pattern day trading protection     
	day trade count 3

	首先，模式當日交易者必須在客戶當日交易的任何一天在其保證金賬戶中維持至少 25,000 美元的淨值。
	在進行任何日內交易活動之前，您的賬戶中必須存在所需的最低淨值（可以是現金和合格證券的組合）。

	如果賬戶低於 25,000 美元的要求，則在賬戶恢復到 25,000 美元的最低淨值水平之前，典型日內交易者將不被允許進行日內交易

	此外，模式日內交易者的交易不能超過其“日內交易購買力”，該購買力通常最高為前一天收盤時維持保證金超額的四倍。
	維持保證金超額是指保證金賬戶中的淨值超過所需保證金的金額。


